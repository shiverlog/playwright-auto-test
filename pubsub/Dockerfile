# Description : Dockerfile - ğŸ“Œ pub/sub Container Image
# Author : Shiwoo Min
# Date : 2025-03-20

# ê²½ëŸ‰ ë² ì´ìŠ¤ ì´ë¯¸ì§€ ì‚¬ìš© (Ubuntu ëŒ€ì‹  Debian Slim)
FROM debian:bookworm-slim AS pubsub

# APT íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸ ë° í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜
RUN apt-get update && apt-get install -y curl wget gnupg apt-transport-https ca-certificates lsb-release

# Google Cloud SDK í‚¤ ë° ì €ì¥ì†Œ ì„¤ì •
RUN curl -fsSL https://packages.cloud.google.com/apt/doc/apt-key.gpg | tee /usr/share/keyrings/cloud.google.asc > /dev/null && \
    echo "deb [signed-by=/usr/share/keyrings/cloud.google.asc] https://packages.cloud.google.com/apt cloud-sdk main" \
    > /etc/apt/sources.list.d/google-cloud-sdk.list

# Google Cloud SDK ì„¤ì¹˜
RUN apt-get update && apt-get install -y google-cloud-sdk

# APT ìºì‹œ ì •ë¦¬
RUN apt-get clean && rm -rf /var/lib/apt/lists/*

# í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (Pub/Sub ì—ë®¬ë ˆì´í„° í¬íŠ¸)
ENV PUBSUB_EMULATOR_HOST=0.0.0.0:8085

# í¬íŠ¸ ë…¸ì¶œ
EXPOSE 8085

# ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì‹œ Pub/Sub ì—ë®¬ë ˆì´í„° ì‹œì‘
CMD ["gcloud", "beta", "emulators", "pubsub", "start", "--host-port=0.0.0.0:8085"]
