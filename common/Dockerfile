# Description : Dockerfile - ğŸ“Œ Common Base Image
# Author : Shiwoo Min
# Date : 2024-03-10

# Ubuntu 24.04 ê¸°ë°˜ ì´ë¯¸ì§€
FROM ubuntu:24.04

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app/common

# ê¸°ë³¸ íŒ¨í‚¤ì§€ ì„¤ì¹˜
RUN apt-get update && apt-get install -y \
    curl \
    gnupg \
    ca-certificates \
    lsb-release \
    && rm -rf /var/lib/apt/lists/*

# Node.js 20 ì„¤ì¹˜ (Node 18 ì´ìƒ í•„ìˆ˜)
RUN curl -fsSL https://deb.nodesource.com/setup_20.x | bash - && \
    apt-get install -y nodejs && \
    apt-get clean

# strict-ssl=false ì„¤ì •, ì‚¬ë‚´ë§ SSL ìš°íšŒ ì˜µì…˜
ENV NODE_TLS_REJECT_UNAUTHORIZED=0

# í”„ë¡ì‹œ í™˜ê²½ì´ ì•„ë‹ˆë¼ë©´ proxy ì„¤ì • ì œê±°
# ENV HTTP_PROXY=http://proxy.company.com:8080
# ENV HTTPS_PROXY=http://proxy.company.com:8080
# ENV NO_PROXY=localhost,127.0.0.1

# npm ì„¤ì • ìµœì í™” (ì¤‘êµ­ mirror ë˜ëŠ” ê¸°ë³¸ ì„¤ì •)
RUN npm config set strict-ssl false && \
    npm config set registry https://registry.npmmirror.com && \
    npm cache clean --force

# ì¢…ì†ì„± ì„¤ì¹˜
COPY package.json package-lock.json ./
RUN npm install --legacy-peer-deps

# common íŒ¨í‚¤ì§€ ì½”ë“œ ë³µì‚¬
COPY common/ .

# ì „ì—­ ë§í¬
RUN npm link

# ì»¨í…Œì´ë„ˆ ìœ ì§€
CMD ["tail", "-f", "/dev/null"]

