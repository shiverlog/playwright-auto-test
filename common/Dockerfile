# Description : Dockerfile - ğŸ“Œ Common Base Image
# Author : Shiwoo Min
# Date : 2024-03-10

# Playwright ê³µì‹ Docker ì´ë¯¸ì§€ (Ubuntu 22.04 ê¸°ë°˜, Node.js í¬í•¨)
FROM mcr.microsoft.com/playwright:v1.40.0-jammy

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /app/common

#strict-ssl=false ì„¤ì •, ì‚¬ë‚´ë§ SSL ìš°íšŒ ì˜µì…˜
ENV NODE_TLS_REJECT_UNAUTHORIZED=0

# í”„ë¡ì‹œ ì„¤ì • (í•„ìš”í•˜ë©´ ì„¤ì •, ë¶ˆí•„ìš”í•˜ë©´ ì œê±°)
ENV HTTP_PROXY=http://proxy.company.com:8080
ENV HTTPS_PROXY=http://proxy.company.com:8080
ENV NO_PROXY=localhost,127.0.0.1

# NPM ì„¤ì • ë³€ê²½ (í•„ìš”í•œ ê²½ìš°)
RUN npm config set strict-ssl false && \
    npm config set registry https://registry.npmmirror.com && \
    npm cache clean --force

# ì• í”Œë¦¬ì¼€ì´ì…˜ ì¢…ì†ì„± ì„¤ì¹˜
COPY package.json package-lock.json ./
RUN npm install --legacy-peer-deps

# common íŒ¨í‚¤ì§€ ì½”ë“œ ì¶”ê°€
COPY common/ .

# common íŒ¨í‚¤ì§€ë¥¼ ê¸€ë¡œë²Œ íŒ¨í‚¤ì§€ë¡œ ë“±ë¡ (npm link ë°©ì‹)
RUN npm link

# ì»¨í…Œì´ë„ˆê°€ ìœ ì§€ë˜ë„ë¡ ì„¤ì •
CMD ["tail", "-f", "/dev/null"]
